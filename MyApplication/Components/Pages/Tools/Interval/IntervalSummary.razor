@page "/tools/intervalsummary"
@using MudBlazor
@using Dapper
@using Microsoft.Data.SqlClient
@using Microsoft.Extensions.Configuration
@using MyApplication.Components.Pages.Tools.Interval
@using Microsoft.AspNetCore.Components.Authorization;
@using System.Security.Claims;
@using System.Net;
@attribute [Authorize(Roles = "Admin,OST,WFM")]

<PageTitle>Interval Summary</PageTitle>

<MudStack Spacing="2">
    <!-- Toolbar -->
    <MudPaper Class="pa-3 d-flex gap-2 align-center" Outlined="true">
        <MudButton Variant="Variant.Filled" OnClick="PopulateAsync" StartIcon="@Icons.Material.Filled.CloudDownload">Populate</MudButton>
        <MudButton Variant="Variant.Outlined" OnClick="CopyStatsAsync" StartIcon="@Icons.Material.Filled.ContentCopy">Copy Stats</MudButton>
        <MudButton Variant="Variant.Outlined"
                   OnClick="GenerateEmailAsync"
                   StartIcon="@Icons.Material.Filled.Email">
            Generate Email
        </MudButton>

        <MudButton Color="Color.Error" Variant="Variant.Outlined" OnClick="ClearAsync" StartIcon="@Icons.Material.Filled.LayersClear">Clear</MudButton>
        <MudSpacer />
    </MudPaper>

    <!-- Interval header -->
    <MudPaper Class="pa-4" Outlined="true">
        <MudGrid Spacing="2">
            <MudItem xs="12" md="2">
                <MudDatePicker @bind-Date="State.Header.IntervalDate" Label="Date" />
            </MudItem>
            <MudItem xs="6" sm="2">
                <MudTextField Class="Header" @bind-Value="State.Header.IntervalStart" Label="Interval Start (HH:mm)" />
            </MudItem>
            <MudItem xs="6" sm="2">
                <MudTextField Class="Header" @bind-Value="State.Header.IntervalEnd" Label="Interval End (HH:mm)" />
            </MudItem>
            <MudItem xs="6" sm="2">
                <MudTextField Class="Header" @bind-Value="State.Header.PopulateTime" Format="yyyy-MM-dd HH:mm"  Label="Latest Refresh Time (ET)" />
            </MudItem>
        </MudGrid>
    </MudPaper>

    <!-- Main Content Area: Left (Stats) / Right (Interval Grid) -->
    <MudGrid>
        <!-- Left Column: Current Day & MTD -->
        <MudItem xs="12" lg="8">
            <MudStack Spacing="2">
                <!-- Current Day Stats -->
                <MudPaper Class="pa-4" Outlined="true">
                    <MudText Typo="Typo.h6">Current Day Stats</MudText>
                    <MudGrid Spacing="2">
                        <!-- USN -->
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.UsnCallsOffered" Label="SvD/USN Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.UsnCallsAnswered" Label="SvD/USN Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.UsnAsa" Label="SvD/USN ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- VIP -->
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.VipCallsOffered" Label="VIP Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.VipCallsAnswered" Label="VIP Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.VipAsa" Label="VIP ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- SIPR -->
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.SiprCallsOffered" Label="SIPR Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.SiprCallsAnswered" Label="SIPR Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.SiprAsa" Label="SIPR ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- NNPI -->
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.NnpiCallsOffered" Label="NNPI Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.NnpiCallsAnswered" Label="NNPI Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="CurrentDay" @bind-Value="State.Current.NnpiAsa" Label="NNPI ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- Email -->
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentEmailCount" Label="Email Inbox Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentEmailAgeHours" Label="Email Oldest (Hours)" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentCustomerCareCount" Label="Cust Care Email Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentCustomerCareAgeHours" Label="Cust Care Email Oldest (Hours)" /></MudItem>
                        
                        <!-- SIPR -->
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprEmailCount" Label="SIPR Email Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprEmailAgeHours" Label="SIPR Email Oldest (Hours)" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprGdaSpreadsheets" Label="SIPR GDA Spreadsheets" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprGdaAgeHours" Label="SIPR GDA Oldest (Hours)" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprUaifCount" Label="SIPR UAIF Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentSiprUaifAgeHours" Label="SIPR UAIF Oldest (Hours)" /></MudItem>
                        <MudItem xs="12" md="6"></MudItem>

                        <!-- Voicemail/ESS -->
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentVmCount" Label=" VM Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentVmAgeHours" Label="VM Oldest (Hours)" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentEssCount" Label="ESS Ticket Count" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="Backlog" @bind-Value="State.Current.CurrentEssAgeHours" Label="ESS Ticket Oldest (Hours)" /></MudItem>
                    </MudGrid>
                </MudPaper>

                <!-- Month To Date -->
                <MudPaper Class="pa-4" Outlined="true">
                    <MudText Typo="Typo.h6">Month To Date</MudText>
                    <MudGrid Spacing="2">
                        <!-- USN -->
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.UsnCallsOffered" Label="SvD/USN Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.UsnCallsAnswered" Label="SvD/USN Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.UsnAsa" Label="SvD/USN ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- VIP -->
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.VipCallsOffered" Label="VIP Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.VipCallsAnswered" Label="VIP Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.VipAsa" Label="VIP ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- SIPR -->
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.SiprCallsOffered" Label="SIPR Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.SiprCallsAnswered" Label="SIPR Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.SiprAsa" Label="SIPR ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- NNPI -->
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.NnpiCallsOffered" Label="NNPI Offered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.NnpiCallsAnswered" Label="NNPI Answered" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.NnpiAsa" Label="NNPI ASA" /></MudItem>
                        <MudItem xs="12" md="3"></MudItem>

                        <!-- EMVM SLR -->
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.Slr33EmLos1" Label="Email LOS 1" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.Slr33EmLos2" Label="Email LOS 2" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.Slr33VmLos1" Label="VM LOS 1" /></MudItem>
                        <MudItem xs="12" md="3"><MudTextField Class="MTD" @bind-Value="State.Mtd.Slr33VmLos2" Label="VM LOS 2" /></MudItem>
                    </MudGrid>
                </MudPaper>
            </MudStack>
        </MudItem>
       
        <!-- Right Column: Interval Grid -->
        <MudItem xs="12" lg="4">
            <MudPaper Class="pa-4 h-100" Outlined="true">
                <MudText Typo="Typo.h6" Class="mb-2">Intervals (Current Day)</MudText>
                <MudTable Items="@State.Intervals" Dense="true" Hover="true" Striped="true" FixedHeader="true" Height="775px">
                    <HeaderContent>
                        <MudTh>Interval</MudTh>
                        <MudTh>Offered</MudTh>
                        <MudTh>Ans</MudTh>
                        <MudTh>ASA</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Interval">@context.IntervalLabel</MudTd>
                        <MudTd DataLabel="Offered">@context.CallsOffered</MudTd>
                        <MudTd DataLabel="Answered">@context.Answered</MudTd>
                        <MudTd DataLabel="ASA">@context.Asa.ToString("F0")</MudTd>
                    </RowTemplate>
                </MudTable>
            </MudPaper>
        </MudItem>
    </MudGrid>

    <!-- Backlog -->
    <MudPaper Class="pa-4" Outlined="true">
        <MudText Typo="Typo.h6">Backlog</MudText>
        <MudGrid Spacing="2">

            <!-- SRM UA -->
            <MudItem xs="12">
            <MudDivider Class="my-4" />     
            <MudText Typo="Typo.subtitle2" Class="mb-2"><b>SRM User Admin</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaAutoCount" Label="SRM UA Auto Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaAutoAgeDays" Label="SRM UA Auto Oldest (Days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaUsnManCount" Label="SRM UA USN Man Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaUsnManAgeDays" Label="SRM UA USN Man Oldest (Days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaSocManCount" Label="SRM UA SOC Man Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmUaSocManAgeDays" Label="SRM UA SOC Man Oldest (Days)" /></MudItem>

            <!-- SRM Validation -->
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2"><b>SRM Validation</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValCount" Label="SRM Validation Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValAgeDays" Label="SRM Validation Oldest (Days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValLineFailCount" Label="SRM Line Fail Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValLineFailAgeDays" Label="SRM Line Fail Oldest (Days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValEmailCount" Label="SRM Email Buildout Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SrmValEmailAgeDays" Label="SRM Email Buildout Oldest (Days)" /></MudItem>

            <!-- SRM AFU -->
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2"><b>SRM Active Followup / Incidents</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.AfuCount" Label="Active Follow Up Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.AfuAgeDays" Label="Active Follow Up Oldest (Days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.CsCount" Label="Cust Sat Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.CsAgeDays" Label="Cust Sat Oldest (Days)" /></MudItem>

            <!-- SRM OCM -->
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2"><b>SRM OCM Activations</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprReadyCount" Label="OCM NIPR Ready Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprReadyAgeHours" Label="OCM NIPR Ready Oldest (hours)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprHoldCount" Label="OCM NIPR Hold Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprHoldAgeHours" Label="OCM NIPR Hold Oldest (hours)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprFatalCount" Label="OCM NIPR Fatal Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmNiprFatalAgeHours" Label="OCM NIPR Fatal Oldest (hours)" /></MudItem>
           
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprReadyCount" Label="OCM SIPR Ready Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprReadyAgeHours" Label="OCM SIPR Ready Oldest (hours)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprHoldCount" Label="OCM SIPR Hold Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprHoldAgeHours" Label="OCM SIPR Hold Oldest (hours)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprFatalCount" Label="OCM SIPR Fatal Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.OcmSiprFatalAgeHours" Label="OCM SIPR Fatal Oldest (hours)" /></MudItem>
            <!-- RDM -->
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2"><b>RDM</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmUsnCount" Label="RDM USN Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmUsnAgeDays" Label="RDM USN Oldest (days)" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmEsdUsnCount" Label="RDM ESD USN Count" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmEsdUsnAgeDays" Label="RDM ESD USN Oldest (days)" /></MudItem>

            <!-- Other Backlog Queues -->
            <MudItem xs="12">
                <MudDivider Class="my-2" />
                <MudText Typo="Typo.subtitle2" Class="mb-2"><b>Other Backlog Queues</b></MudText>
            </MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.NnpiQueue" Label="SVD.NNPI" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.SiprQueue" Label="SVD.SIPR" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.NcisQueue" Label="SVD.NCIS" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.VipQueue" Label="SVD.VIP" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmNnpiQueue" Label="RDM.NNPI" /></MudItem>
            <MudItem xs="3" md="2"><MudTextField Class="Backlog" @bind-Value="State.Backlog.RdmSiprQueue" Label="RDM.SIPR" /></MudItem>
        </MudGrid>
    </MudPaper>

    <!-- Notes / Comments -->
    <MudPaper Class="pa-4" Outlined="true">
        <MudText Typo="Typo.h6">Notes / Comments</MudText>
        <MudGrid Spacing="2">
            <MudItem xs="12" md="6">
                <MudTextField Class="Notes" @bind-Value="State.Notes.NaTodaysFocusArea" Label="Today's Focus Areas" Lines="2" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField Class="Notes" @bind-Value="State.Notes.NaMajorCirImpact" Label="Major CIRs Impacting ASA" Lines="2" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField Class="Notes" @bind-Value="State.Notes.NaImpactingEvents" Label="Impacting Events" Lines="2" />
            </MudItem>
            <MudItem xs="12" md="6">
                <MudTextField Class="Notes" @bind-Value="State.Notes.NaHpsmStatus" Label="HPSM Status" Lines="2" />
            </MudItem>
            <MudItem xs="12" >
                <MudTextField Class="Notes" @bind-Value="State.Notes.NaManagementNotes" Label="Management Notes" Lines="3" />
            </MudItem>
        </MudGrid>
    </MudPaper>
</MudStack>