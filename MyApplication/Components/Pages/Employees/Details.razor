@page "/employees/{Id:int}"
@attribute [Authorize(Policy = "Admin")]
@using MyApplication.Components.Service.Employee
@inject EmployeesRepository Repository
@inject NavigationManager Nav

<MudStack Spacing="4" Class="mb-8">
    <MudStack Row="true" AlignItems="AlignItems.Center">
        <MudIconButton Icon="@Icons.Material.Filled.ArrowBack" OnClick="@(() => Nav.NavigateTo("/employees"))" />
        <MudText Typo="Typo.h5">Employee Details</MudText>
    </MudStack>

    @if (_loading)
    {
        <MudProgressCircular Indeterminate="true" />
    }
    else if (_vm == null)
    {
        <MudAlert Severity="Severity.Error">Employee not found.</MudAlert>
    }
    else
    {
        <MudGrid>
            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4 h-100" Outlined="true">
                    <MudText Typo="Typo.h6" Class="mb-4" Color="Color.Primary">Profile</MudText>
                    <MudSimpleTable Dense="true" Hover="false" Striped="false" Elevation="0">
                        <tbody>
                            <tr><td><b>Name</b></td><td>@_vm.LastName, @_vm.FirstName @_vm.MiddleInitial</td></tr>
                            <tr><td><b>Corp ID</b></td><td>@_vm.CorporateId</td></tr>
                            <tr><td><b>Domain</b></td><td>@_vm.DomainLoginName</td></tr>
                            <tr><td><b>Email</b></td><td>@_vm.CorporateEmail</td></tr>
                            <tr><td><b>NMCI</b></td><td>@_vm.NmciEmail</td></tr>
                            <tr><td><b>USN IDs</b></td><td>@_vm.UsnOperatorId / @_vm.UsnAdminId</td></tr>
                        </tbody>
                    </MudSimpleTable>
                </MudPaper>
            </MudItem>

            <MudItem xs="12" md="6">
                <MudPaper Class="pa-4 h-100" Outlined="true">
                    <MudText Typo="Typo.h6" Class="mb-4" Color="Color.Primary">Current Assignment</MudText>
                    @if (_vm.HasHistory)
                    {
                        <MudSimpleTable Dense="true" Hover="false" Striped="false" Elevation="0">
                            <tbody>
                                <tr><td><b>Effective</b></td><td>@_vm.EffectiveDate</td></tr>
                                <tr><td><b>Employer</b></td><td>@_vm.Employer</td></tr>
                                <tr><td><b>Site</b></td><td>@_vm.Site</td></tr>
                                <tr><td><b>Org</b></td><td>@_vm.Organization / @_vm.SubOrganization</td></tr>
                                <tr><td><b>Manager</b></td><td>@_vm.Manager</td></tr>
                                <tr><td><b>Supervisor</b></td><td>@_vm.Supervisor</td></tr>
                                <tr>
                                    <td><b>Status</b></td>
                                    <td>
                                        <MudChip T="bool" Size="Size.Small" Color="@(_vm.IsRemote? Color.Success: Color.Default)">Remote: @_vm.IsRemote</MudChip>
                                        @if (_vm.IsLoa)
                                        {
                                            <MudChip T="bool" Size="Size.Small" Color="Color.Warning">LOA</MudChip>
                                        }
                                        @if (_vm.IsIntLoa)
                                        {
                                            <MudChip T="bool" Size="Size.Small" Color="Color.Warning">Int LOA</MudChip>
                                        }
                                    </td>
                                </tr>
                            </tbody>
                        </MudSimpleTable>
                    }
                    else
                    {
                        <MudText Color="Color.Secondary">No assignment history found.</MudText>
                    }
                </MudPaper>
            </MudItem>
        </MudGrid>

        <MudPaper Class="pa-4" Outlined="true">
            <MudText Typo="Typo.h6" Class="mb-2" Color="Color.Success">Active Skills</MudText>
            @if (_vm.Skills.Any())
            {
                <MudChipSet T="string" ReadOnly="true">
                    @foreach (var skill in _vm.Skills)
                    {
                        <MudChip T="string"
                                 Size="Size.Small"
                                 Color="Color.Primary"
                                 Variant="Variant.Outlined">
                            @skill
                        </MudChip>
                    }
                </MudChipSet>
            }
            else
            {
                <MudText Typo="Typo.caption">No active skills recorded.</MudText>
            }
        </MudPaper>

        @if (_vm.Schedule != null)
        {
            <MudPaper Class="pa-4" Outlined="true">
                <MudText Typo="Typo.h6" Class="mb-2" Color="Color.Primary">Current Schedule</MudText>

                <MudText Typo="Typo.subtitle2" Class="ml-2">Shift 1</MudText>
                <MudSimpleTable Style="overflow-x: auto;" Dense="true" Class="mb-3">
                    <thead><tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>@_vm.Schedule.Mon</td>
                            <td>@_vm.Schedule.Tue</td>
                            <td>@_vm.Schedule.Wed</td>
                            <td>@_vm.Schedule.Thu</td>
                            <td>@_vm.Schedule.Fri</td>
                            <td>@_vm.Schedule.Sat</td>
                            <td>@_vm.Schedule.Sun</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>

                @if (_vm.Schedule2 != null)
                {
                    <MudText Typo="Typo.subtitle2" Class="ml-2 mt-4">Shift 2 (Split)</MudText>
                    <MudSimpleTable Style="overflow-x: auto;" Dense="true">
                        <thead><tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th></tr></thead>
                        <tbody>
                            <tr>
                                <td>@_vm.Schedule2.Mon</td>
                                <td>@_vm.Schedule2.Tue</td>
                                <td>@_vm.Schedule2.Wed</td>
                                <td>@_vm.Schedule2.Thu</td>
                                <td>@_vm.Schedule2.Fri</td>
                                <td>@_vm.Schedule2.Sat</td>
                                <td>@_vm.Schedule2.Sun</td>
                            </tr>
                        </tbody>
                    </MudSimpleTable>
                }
            </MudPaper>
        }

        @if (_vm.Overtime != null)
        {
            <MudPaper Class="pa-4" Outlined="true">
                <MudText Typo="Typo.h6" Class="mb-2" Color="Color.Warning">Overtime Adjustment</MudText>
                <MudSimpleTable Dense="true">
                    <thead><tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>@_vm.Overtime.Mon</td>
                            <td>@_vm.Overtime.Tue</td>
                            <td>@_vm.Overtime.Wed</td>
                            <td>@_vm.Overtime.Thu</td>
                            <td>@_vm.Overtime.Fri</td>
                            <td>@_vm.Overtime.Sat</td>
                            <td>@_vm.Overtime.Sun</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>
            </MudPaper>
        }

        @if (_vm.StaticBreaks != null)
        {
            <MudPaper Class="pa-4" Outlined="true">
                <MudText Typo="Typo.h6" Class="mb-2" Color="Color.Info">Static Break Schedule</MudText>
                <MudSimpleTable Dense="true">
                    <thead><tr><th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th></tr></thead>
                    <tbody>
                        <tr>
                            <td>@_vm.StaticBreaks.Mon</td>
                            <td>@_vm.StaticBreaks.Tue</td>
                            <td>@_vm.StaticBreaks.Wed</td>
                            <td>@_vm.StaticBreaks.Thu</td>
                            <td>@_vm.StaticBreaks.Fri</td>
                            <td>@_vm.StaticBreaks.Sat</td>
                            <td>@_vm.StaticBreaks.Sun</td>
                        </tr>
                    </tbody>
                </MudSimpleTable>
            </MudPaper>
        }

        <MudPaper Class="pa-4" Outlined="true">
            <MudText Typo="Typo.h6" Class="mb-2">History</MudText>
            <MudTabs Elevation="0" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-2">

                <MudTabPanel Text="ACR History">
                    <MudTable Items="_vm.AcrHistory" Dense="true" Hover="true" Striped="true" Elevation="0">
                        <HeaderContent>
                            <MudTh>ID</MudTh>
                            <MudTh>Type</MudTh>
                            <MudTh>Status</MudTh>
                            <MudTh>Effective</MudTh>
                            <MudTh>Submitted</MudTh>
                            <MudTh></MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd>@context.Id</MudTd>
                            <MudTd>@context.Type</MudTd>
                            <MudTd>@context.Status</MudTd>
                            <MudTd>@context.EffectiveDate</MudTd>
                            <MudTd>@context.Submitted</MudTd>
                            <MudTd>
                                <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" OnClick="@(() => Nav.NavigateTo($"/acr/{context.Id}"))" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudTabPanel>

                <MudTabPanel Text="OPERA History">
                    <MudTable Items="_vm.OperaHistory" Dense="true" Hover="true" Striped="true" Elevation="0">
                        <HeaderContent>
                            <MudTh>ID</MudTh>
                            <MudTh>Type</MudTh>
                            <MudTh>Sub-Type</MudTh>
                            <MudTh>Start</MudTh>
                            <MudTh>End</MudTh>
                            <MudTh>Status</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd>@context.RequestId</MudTd>
                            <MudTd>@context.Type</MudTd>
                            <MudTd>@context.SubType</MudTd>
                            <MudTd>@context.StartTime</MudTd>
                            <MudTd>@context.EndTime</MudTd>
                            <MudTd>@context.Status</MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudTabPanel>

            </MudTabs>
        </MudPaper>
    }
</MudStack>

@code {
    [Parameter] public int Id { get; set; }
    private EmployeeFullDetailsVm _vm;
    private bool _loading = true;

    protected override async Task OnInitializedAsync()
    {
        _vm = await Repository.GetFullDetailsAsync(Id);
        _loading = false;
    }
}